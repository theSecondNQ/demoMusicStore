<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>éŸ³ä¹åˆ—è¡¨ - éŸ³ä¹å•†åº—</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .user-info { float: right; }
        .search-form { margin: 20px 0; }
        .music-list { list-style: none; padding: 0; }
        .music-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .music-title { font-size: 18px; font-weight: bold; }
        .music-info { color: #666; margin: 5px 0; }
        .actions { margin-top: 10px; }
        .btn { padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .favourite { color: red; }
        .admin-actions { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸµ éŸ³ä¹å•†åº—</h1>

    <div class="user-info">
        <div th:if="${session.user}">
            æ¬¢è¿ï¼Œ<span th:text="${session.user.username}"></span>ï¼
            <a th:href="@{/profile}" class="btn btn-primary">ä¸ªäººä¸­å¿ƒ</a>
            <a th:href="@{/favourite/list}" class="btn btn-primary">æˆ‘çš„æ”¶è—</a>
            <a th:href="@{/cart/list}" class="btn btn-primary">è´­ç‰©è½¦</a>
            <a th:if="${session.user.role != 'admin'}" th:href="@{/order/list}" class="btn btn-primary">æˆ‘çš„è®¢å•</a>
            <a th:href="@{/logout}" class="btn btn-danger">é€€å‡º</a>
        </div>
        <div th:unless="${session.user}">
            <a th:href="@{/login}" class="btn btn-primary">ç™»å½•</a>
            <a th:href="@{/register}" class="btn btn-success">æ³¨å†Œ</a>
        </div>
    </div>
    <div style="clear: both;"></div>
</div>

<form method="get" class="search-form">
    <input type="text" name="keyword" placeholder="æœç´¢æ­Œæ›²ã€æ­Œæ‰‹æˆ–ä¸“è¾‘..." th:value="${keyword}">
    <select name="category">
        <option value="">æ‰€æœ‰åˆ†ç±»</option>
        <option th:each="c : ${categories}"
                th:value="${c.name}"
                th:text="${c.name}"
                th:selected="${category == c.name}">
        </option>
    </select>
    <button type="submit" class="btn btn-primary">æœç´¢</button>
    <a th:href="@{/music/list}" class="btn">é‡ç½®</a>
</form>

<div th:if="${musicList}">
    <h2>éŸ³ä¹åˆ—è¡¨</h2>
    <ul class="music-list">
        <li th:each="music : ${musicList}" class="music-item">
            <div class="music-title">
                <a th:href="@{'/music/detail/' + ${music.id}}" th:text="${music.title}"></a>
                <span th:if="${music.favourite}" class="favourite"> â™¥</span>
            </div>
            <div class="music-info">
                æ­Œæ‰‹ï¼š<span th:text="${music.artist}"></span> |
                ä¸“è¾‘ï¼š<span th:text="${music.album}"></span> |
                åˆ†ç±»ï¼š<span th:text="${music.categoryName}"></span> |
                æ—¶é•¿ï¼š<span th:text="${#numbers.formatInteger(music.duration/60, 1)}"></span>:<span th:text="${#numbers.formatInteger(music.duration%60, 2)}"></span> |
                æ’­æ”¾é‡ï¼š<span th:text="${music.playCount}"></span>
            </div>
            <div class="music-info">
                ä»·æ ¼ï¼šï¿¥<span th:text="${#numbers.formatDecimal(music.price, 1, 2)}"></span>
            </div>
            <div class="actions" th:if="${session.user}">
                <form th:action="@{'/favourite/add/' + ${music.id}}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-primary" th:disabled="${music.favourite}">
                        <span th:if="${music.favourite}">å·²æ”¶è—</span>
                        <span th:unless="${music.favourite}">æ”¶è—</span>
                    </button>
                </form>
                <form th:action="@{/cart/add}" method="post" style="display: inline;">
                    <input type="hidden" name="musicId" th:value="${music.id}">
                    <input type="number" name="quantity" value="1" min="1" style="width: 60px;">
                    <button type="submit" class="btn btn-success">åŠ å…¥è´­ç‰©è½¦</button>
                </form>
                <div th:if="${session.user != null && session.user.role == 'admin'}" style="display: inline; margin-left: 10px;">
                    <a th:href="@{'/music/edit/' + ${music.id}}" class="btn btn-warning btn-sm">ç¼–è¾‘</a>
                    <a th:href="@{'/music/delete/' + ${music.id}}" class="btn btn-danger btn-sm"
                       onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™é¦–éŸ³ä¹å—ï¼Ÿ')">åˆ é™¤</a>
                </div>
            </div>
        </li>
    </ul>
</div>

<div th:if="${session.user != null && session.user.role == 'admin'}" class="admin-actions">
    <h3>ç®¡ç†å‘˜åŠŸèƒ½</h3>
    <a th:href="@{/music/add}" class="btn btn-primary">æ·»åŠ éŸ³ä¹</a>
    <a th:href="@{/admin/categories}" class="btn btn-primary">åˆ†ç±»ç®¡ç†</a>
    <a th:href="@{/admin/users}" class="btn btn-primary">ç”¨æˆ·ç®¡ç†</a>
    <a th:href="@{/order/admin}" class="btn btn-primary">è®¢å•ç®¡ç†</a>
    <a th:href="@{/admin/site/info}" class="btn btn-primary">ç½‘ç«™è®¾ç½®</a>
</div>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>